<div class="text-end mb-4">
    <button class="btn btn-outline-light" (click)="voltar()">Voltar</button>
</div>
<div class="form-wrapper">

  <div class="form-card">

    <div class="text-center mb-4">
      <h1>Atualizar Usuário</h1>
    </div>

    <form [formGroup]="clientUpdateForm" (ngSubmit)="atualizarUsuario()" novalidate>

      <div class="form-group">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" class="form-control" formControlName="nome"
        [class.is-invalid]="clientUpdateForm.get('nome')?.invalid && clientUpdateForm.get('nome')?.touched">
        <div class="invalid-feedback" *ngIf="clientUpdateForm.get('nome')?.touched && clientUpdateForm.get('nome')?.errors?.['required']">
            O nome é obrigatório.
        </div>
        <div class="invalid-feedback" *ngIf="clientUpdateForm.get('nome')?.touched && clientUpdateForm.get('nome')?.errors?.['minlength']">
            O nome deve ter no mínimo 3 caracteres.
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" class="form-control" formControlName="email"
        [class.is-invalid]="clientUpdateForm.get('email')?.invalid && clientUpdateForm.get('email')?.touched">
        <div class="invalid-feedback" *ngIf="clientUpdateForm.get('email')?.touched && clientUpdateForm.get('email')?.errors?.['required']">
            O e-mail é obrigatório.
        </div>
        <div class="invalid-feedback" *ngIf="clientUpdateForm.get('email')?.touched && clientUpdateForm.get('email')?.errors?.['email']">
            Informe um e-mail válido.
        </div>
      </div>

      <div class="form-group">
        <label for="salario">Salário:</label>
        <input type="text" id="salario" class="form-control" formControlName="salario"
          mask="separator.2"
          thousandSeparator="."
          decimalMarker=","
          prefix="R$ "
        [class.is-invalid]="clientUpdateForm.get('salario')?.invalid && clientUpdateForm.get('salario')?.touched">
        <div class="invalid-feedback" *ngIf="clientUpdateForm.get('salario')?.touched && clientUpdateForm.get('salario')?.errors?.['required']">
            O salário é obrigatório.
        </div>
        <div class="invalid-feedback" *ngIf="clientUpdateForm.get('salario')?.touched && clientUpdateForm.get('salario')?.errors?.['min']">
            O salário não pode ser negativo.
        </div>
      </div>

      <div class="form-group">
        <label for="cep">CEP:</label>
        <input type="text" id="cep" class="form-control" formControlName="cep"
        placeholder="00000-000"
        mask="00000-000"
        [class.is-invalid]="(clientUpdateForm.get('cep')?.invalid && clientUpdateForm.get('cep')?.touched) || cepNotFound">
        <div class="spinner-border spinner-border-sm text-primary position-absolute end-0 top-50 translate-middle-y me-3"
                 *ngIf="loadingCep" role="status">
                <span class="visually-hidden">Buscando...</span>
        </div>
        <div class="invalid-feedback" *ngIf="clientUpdateForm.get('cep')?.touched && clientUpdateForm.get('cep')?.errors?.['required']">
            O CEP é obrigatório.
        </div>
        <div class="invalid-feedback" *ngIf="clientUpdateForm.get('cep')?.touched && clientUpdateForm.get('cep')?.errors?.['pattern']">
            CEP inválido (use 00000-000).
        </div>
        <div class="invalid-feedback d-block" *ngIf="cepNotFound">
            CEP não encontrado.
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="logradouro">Logradouro:</label>
          <input type="text" id="logradouro" class="form-control" formControlName="logradouro">
        </div>
        <div class="form-group">
          <label for="numero">Número:</label>
          <input type="text" id="numero" class="form-control" formControlName="numero"
          [class.is-invalid]="clientUpdateForm.get('numero')?.invalid && clientUpdateForm.get('numero')?.touched">
          <div class="invalid-feedback" *ngIf="clientUpdateForm.get('numero')?.touched && clientUpdateForm.get('numero')?.errors?.['required']">
            O número é obrigatório.
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="complemento">Complemento:</label>
        <input type="text" id="complemento" class="form-control" formControlName="complemento">
      </div>

      <div class="form-group">
        <label for="bairro">Bairro:</label>
        <input type="text" id="bairro" class="form-control" formControlName="bairro">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="cidade">Cidade:</label>
          <input type="text" id="cidade" class="form-control" formControlName="cidade">
        </div>
        <div class="form-group">
          <label for="estado">Estado:</label>
          <input type="text" id="estado" class="form-control" formControlName="estado">
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-100 mt-4" [disabled]="clientUpdateForm.invalid">
        Salvar Alterações
      </button>
    </form>

    <div class="mt-4">
      <div *ngIf="status === 'success'" class="alert alert-success">
        Usuário atualizado com sucesso!
      </div>
      <div *ngIf="status === 'error'" class="alert alert-danger">
        Falha ao atualizar. Por favor, tente novamente.
      </div>
    </div>

  </div> </div>
