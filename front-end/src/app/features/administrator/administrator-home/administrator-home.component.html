<app-header [navItems]="navItems"></app-header>

<div class="admin-home">

  <div *ngIf="dashboardData.loading" class="d-flex justify-content-center align-items-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando dashboard...</span>
    </div>
  </div>

  <div *ngIf="!dashboardData.loading">
    <header class="mb-3">
      <h1 class="titulo">Dashboard — Administrador</h1>
      <p class="sub">Resumo geral e detalhamento por gerente</p>

      <div class="toolbar">
        <input
          type="search"
          class="input"
          placeholder="Buscar gerente por nome…"
          [value]="filtroNome()"
          (input)="onFiltroChange($event)"
          aria-label="Buscar gerente por nome"
        />

        <select
          class="select"
          [value]="ordenarPor()"
          (change)="onOrdenarChange($event)"
          aria-label="Ordenar por"
        >
          <option value="somaPositivos">Maior Saldo Positivo</option>
          <option value="somaNegativos">Maior Saldo Negativo</option>
          <option value="qtdClientes">Mais Clientes</option>
          <option value="nome">Nome (A–Z)</option>
        </select>

        <label class="check">
          <input type="checkbox" [checked]="apenasNegativos()" (change)="onApenasNegativosChange($event)" />
          Apenas gerentes com carteira negativa
        </label>
      </div>

      <section class="totals" aria-label="Totais gerais">
        <div class="kpi">
          <span class="kpi-label">Total de gerentes</span>
          <span class="kpi-value">{{ dashboardData.totalGerentes }}</span>
        </div>
        <div class="kpi">
          <span class="kpi-label">Total de clientes</span>
          <span class="kpi-value">{{ dashboardData.totalClientes }}</span>
        </div>
        <div class="kpi">
          <span class="kpi-label">Saldo Global (Positivo)</span>
          <span class="kpi-value positivo">{{ asCurrency(dashboardData.somaPositivosGlobal) }}</span>
        </div>
        <div class="kpi">
          <span class="kpi-label">Saldo Global (Negativo)</span>
          <span class="kpi-value negativo">{{ asCurrency(dashboardData.somaNegativosGlobal) }}</span>
        </div>
      </section>
    </header>

    <section class="cards" aria-live="polite">
      @if (linhasFiltradas().length === 0) {
        <div class="empty">
          Nenhum gerente encontrado para os filtros atuais.
        </div>
      } @else {
        @for (l of linhasFiltradas(); track l.id) {
          <article class="card">
            <div class="card-header">
              <h2 class="nome">{{ l.nome }}</h2>
              <span class="badge" aria-label="Quantidade de clientes">{{ l.qtdClientes }} clientes</span>
            </div>

            <div class="card-body">
              <div class="metric">
                <span class="label">Carteira (Positiva)</span>
                <span class="value positivo">{{ asCurrency(l.somaPositivos) }}</span>
              </div>
              <div class="metric">
                <span class="label">Carteira (Negativa)</span>
                <span class="value negativo">{{ asCurrency(l.somaNegativos) }}</span>
              </div>
            </div>
          </article>
        }
      }
    </section>
  </div>
</div>
